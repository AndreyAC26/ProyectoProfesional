@model MVCMuncheese.Models.modeloFacturas

@{
    ViewBag.Title = "Factura";

}

<script>

    ddlClientes.change(function () {
        var clienteId = $(this).val(); // Obtener el valor del cliente seleccionado
        if (clienteId !== '') { // Verificar si se seleccionó un cliente
            $.ajax({
                url: '/Factura/GetTelefonoCliente',
                type: 'GET',
                data: { clienteId: clienteId },
                success: function (response) {
                    txtTelefono.val(response); // Asignar el número de teléfono al campo correspondiente
                },
                error: function () {
                    console.log('Error al obtener el número de teléfono del cliente.');
                }
            });
        } else {
            txtTelefono.val(''); // Limpiar el campo si no hay cliente seleccionado
        }
    });

    $(document).ready(function() {
        $("#Cliente").change(function() {
            var clienteSeleccionado = $(this).val();
            $.ajax({
                url: "@Url.Action("ObtenerTelefonoCliente", "Factura")",
                data: { nombreCliente: clienteSeleccionado },
                type: "POST",
                success: function(respuesta) {
                    $("#Tel_Cliente").val(respuesta);
                },
                error: function() {
                    console.log("Error al obtener el número de teléfono del cliente.");
                }
            });
        });
    });

    $.ajax({
    url: '@Url.Action("ObtenerTelefonoCliente", "Facturas")',
    type: 'GET',
    dataType: 'json',
    data: { cliente: selectedCliente }, // Enviar el nombre del cliente seleccionado como parámetro
    success: function (telefono) {
        // Asignar el número de teléfono al campo correspondiente
        $("#txtTelefono").val(telefono);
        $("#txtTelefono").show(); // Mostrar el campo de texto
    },
    error: function () {
        console.log('Error al obtener el número de teléfono del cliente.');
    }
});

    
</script>

<div>
    <h3 style="text-align:center;">
        Factura
    </h3>
</div>


<nav class="navbar navbar-default" style="padding-top:10px; display: flex; justify-content: space-between;">
    <div class="row">
        <div class="col-md-12" id="contenedor1">
            <h4 class="info" style="font-size:12px; text-align:center;"> Muncheese Comida callejera </h4>
            <h4 class="info" style="font-size:10px; text-align:center;"> Sarchí Centro Comercial Valverde Vega </h4>
            <h4 class="info" style="font-size:10px; text-align:center;"> Local #19 o donde nos invitan con el FoodTruck, Alajuela, Costa Rica </h4>
        </div>


        <div class="col-md-12 text-right" id="contenedor2">

            <div class="col-md-3 text-right">
                <div class="form-group row">
                    @Html.LabelFor(model => model.mesa, htmlAttributes: new { @class = "col-sm-3 col-form-label" })
                    <div class="col-sm-6">
                        @Html.DropDownListFor(model => model.mesa, Model.MesasActivas, "-- Mesa --", new { @class = "form-control", id = "mesa-dropdown" })
                        @Html.ValidationMessageFor(model => model.mesa, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-group row">
                    @Html.LabelFor(model => model.Id_Orden, htmlAttributes: new { @class = "col-sm-3 col-form-label" })
                    <div class="col-sm-6">
                        @Html.DropDownListFor(model => model.Id_Orden, Enumerable.Empty<SelectListItem>(), "-- Orden --", new { @class = "form-control", id = "orden-dropdown" })
                        @Html.ValidationMessageFor(model => model.Id_Orden, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>

            <div class="col-md-3 text-right">
                <div class="form-group row">
                    @Html.LabelFor(model => model.fecha, htmlAttributes: new { @class = "col-sm-3 col-form-label" })
                    <div class="col-sm-7">
                        @Html.EditorFor(model => model.fecha, new { htmlAttributes = new { @class = "form-control form-control-lg", style = "height: 30px;", type = "date" } })
                        @Html.ValidationMessageFor(model => model.fecha, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-group row">
                    @Html.LabelFor(model => model.Cliente, htmlAttributes: new { @class = "col-sm-3 col-form-label" })
                    <div class="col-sm-6">
                        @Html.DropDownListFor(model => model.Cliente, Model.Clientes, "Cliente", new { @class = "form-control", id = "ddlClientes" })
                        @Html.ValidationMessageFor(model => model.Cliente, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>

            <div class="col-md-3 text-lef">
                <div class="form-group row">
                    @Html.LabelFor(model => model.Tel_Cliente, htmlAttributes: new { @class = "col-sm-3 col-form-label" })
                    <div class="col-sm-6 text-right">
                        @Html.EditorFor(model => model.Tel_Cliente, new { htmlAttributes = new { @class = "form-control", @id = "txtTelefono", @style = "display:none;" } })
                        @Html.ValidationMessageFor(model => model.Tel_Cliente, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>


<div class="col-md-12" style="text-align:center;">


    <table class="table table-striped table-hover ">
        <thead>
        </thead>
        <tr>
            <th></th>
            <th>Cantidad</th>
            <th>Descripción</th>
            <th>Producto</th>
            <th>Precio</th>
            <th>Orden</th>
            <th>Estado</th>
            <th>Sub Total</th>

        </tr>
        <tbody>
            <tr class="active">
                <th>

                </th>
                <th>
                    @*1*@
                </th>
                <th>
                    @*Sin mostaza*@
                </th>
                <th>
                    @*1*@
                </th>
                <th>
                    @*4500*@
                </th>
                <th>
                    @*2*@
                </th>
                <th>
                    @*Comer aqui*@
                </th>
                <th>
                    @*4500*@
                </th>
            </tr>
            <tr class="active">
                <th>

                </th>
                <th>
                    @*3*@
                </th>
                <th>
                    @*N/A*@
                </th>
                <th>
                    @*3*@
                </th>
                <th>
                    @*5000*@
                </th>
                <th>
                    @*2*@
                </th>
                <th>
                    @*Comer aqui*@
                </th>
                <th>
                    @*15000*@
                </th>
            </tr>
            <tr class="active">
                <th>

                </th>
                <th>
                    @*1*@
                </th>
                <th>
                    @*Con muchas salsas*@
                </th>
                <th>
                    @*1*@
                </th>
                <th>
                    @*6500*@
                </th>
                <th>
                    @*2*@
                </th>
                <th>
                    @*Comer aqui*@
                </th>
                <th>
                    @*6500*@
                </th>
            </tr>
            <tr class="active">
                <th>

                </th>
                <th>

                </th>
                <th>

                </th>
                <th>

                </th>
                <th>

                </th>
                <th>

                </th>
                <th style="text-align:right;">
                    @*Total:*@
                </th>
                <th>
                    @*26000*@
                </th>
            </tr>
        </tbody>
    </table>
    <div class="form-group col-md-12" style="text-align:right">
        <div class="col-lg-10 col-lg-offset-2">
            <button type="submit" class="btn btn-primary">Facturar</button>
        </div>
    </div>

</div>

@section Scripts {
    <script type="text/javascript">
        $(function () {
            // Manejar el evento de selección del dropdownlist "Clientes"
            $("#ddlClientes").change(function () {
                var selectedCliente = $(this).val(); // Obtener el cliente seleccionado
                if (selectedCliente !== "") {
                    // Obtener el número de teléfono del cliente seleccionado mediante una petición AJAX
                    $.ajax({
                        url: '@Url.Action("ObtenerTelefonoCliente", "Facturas")',
                        type: 'GET',
                        dataType: 'json',
                        data: { cliente: selectedCliente }, // Enviar el nombre del cliente seleccionado como parámetro
                        success: function (telefono) {
                            // Asignar el número de teléfono al campo correspondiente
                            $("#txtTelefono").val(telefono);
                            $("#txtTelefono").show(); // Mostrar el campo de texto
                        },
                        error: function () {
                            console.log('Error al obtener el número de teléfono del cliente.');
                        }
                    });
                } else {
                    $("#txtTelefono").val(''); // Limpiar el campo si no hay cliente seleccionado
                    $("#txtTelefono").hide(); // Ocultar el campo de texto
                }
            });
        });


    </script>
}